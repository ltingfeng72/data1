# 图书管理系统 - 部署指南

## 完整部署步骤（适合初学者）

### 准备工作

#### Windows 系统部署

##### 1. 安装 MySQL 数据库

1. 下载 MySQL Community Server
   - 访问: https://dev.mysql.com/downloads/mysql/
   - 选择 Windows 版本下载
   - 运行安装程序

2. 安装过程中设置：
   - Root 密码（记住这个密码！）
   - 默认端口：3306
   - 选择：MySQL Server + MySQL Workbench

3. 验证安装：
   ```cmd
   mysql --version
   ```

##### 2. 安装 MySQL ODBC 驱动

1. 下载 MySQL Connector/ODBC
   - 访问: https://dev.mysql.com/downloads/connector/odbc/
   - 选择对应的 Windows 版本
   - 运行安装程序

2. 配置 ODBC 数据源：
   - 打开"控制面板" → "管理工具" → "ODBC 数据源（64位）"
   - 点击"系统 DSN" → "添加"
   - 选择"MySQL ODBC 8.0 Unicode Driver"
   - 配置：
     * Data Source Name: `LibraryDB`
     * TCP/IP Server: `localhost`
     * Port: `3306`
     * User: `root`
     * Password: [你的 MySQL 密码]
     * Database: `library`
   - 点击"Test"测试连接
   - 点击"OK"保存

##### 3. 安装 C++ 编译器

**选项 A: Visual Studio (推荐)**
1. 下载 Visual Studio Community
   - 访问: https://visualstudio.microsoft.com/zh-hans/
   - 选择"C++ 桌面开发"工作负载
   - 安装

**选项 B: MinGW**
1. 下载 MinGW-w64
   - 访问: https://sourceforge.net/projects/mingw-w64/
   - 安装并添加到 PATH

##### 4. 创建数据库

1. 打开命令提示符（cmd）
2. 执行：
   ```cmd
   mysql -u root -p
   ```
3. 输入 MySQL 密码
4. 创建数据库：
   ```sql
   CREATE DATABASE library CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   USE library;
   SOURCE C:\path\to\database\schema.sql;
   ```
   （将路径改为实际路径）

##### 5. 修改源代码配置

编辑 `src/main.cpp`，找到第 103-105 行：
```cpp
const char* dsn = "LibraryDB";
const char* user = "root";
const char* password = "password";  // 改为你的 MySQL 密码
```

##### 6. 编译程序

**使用 Visual Studio:**
1. 打开"开发人员命令提示符"
2. 执行：
   ```cmd
   cd C:\path\to\src
   cl main.cpp odbc32.lib
   ```

**使用 MinGW:**
```cmd
cd C:\path\to\src
g++ -o library_system.exe main.cpp -lodbc32
```

##### 7. 运行程序

```cmd
main.exe
```
或
```cmd
library_system.exe
```

#### Linux 系统部署（Ubuntu/Debian）

##### 1. 安装 MySQL

```bash
sudo apt-get update
sudo apt-get install mysql-server
```

设置 root 密码：
```bash
sudo mysql_secure_installation
```

##### 2. 安装 ODBC 驱动

```bash
sudo apt-get install unixodbc unixodbc-dev
sudo apt-get install libmyodbc
```

##### 3. 配置 ODBC DSN

编辑 `/etc/odbc.ini` 或 `~/.odbc.ini`:
```ini
[LibraryDB]
Description = Library Management System Database
Driver = MySQL
Server = localhost
Database = library
Port = 3306
User = root
Password = your_mysql_password
```

编辑 `/etc/odbcinst.ini`:
```ini
[MySQL]
Description = MySQL ODBC Driver
Driver = /usr/lib/x86_64-linux-gnu/odbc/libmyodbc8w.so
Setup = /usr/lib/x86_64-linux-gnu/odbc/libodbcmyS.so
FileUsage = 1
```

测试连接：
```bash
isql LibraryDB root your_password
```

##### 4. 安装 C++ 编译器

```bash
sudo apt-get install g++ build-essential
```

##### 5. 创建数据库

```bash
mysql -u root -p
```

```sql
CREATE DATABASE library CHARACTER SET utf8mb4;
USE library;
SOURCE /path/to/database/schema.sql;
```

##### 6. 修改源代码配置

编辑 `src/main.cpp` 第 105 行，修改密码：
```cpp
const char* password = "your_mysql_password";
```

##### 7. 编译程序

```bash
cd src
g++ -o library_system main.cpp -lodbc
```

##### 8. 运行程序

```bash
./library_system
```

### 使用说明

#### 登录系统

程序启动后，使用默认账户登录：

| 角色   | 用户名    | 密码     |
|-------|----------|---------|
| 管理员 | admin    | admin123|
| 操作员 | operator | oper123 |
| 读者   | reader1  | read123 |

#### 管理员操作

登录后可以：
1. 添加图书 - 输入书名、出版日期、出版社、书架ID、房间ID
2. 删除图书 - 输入图书ID
3. 修改图书 - 输入图书ID和新信息

#### 操作员操作

1. 借书登记 - 输入读者ID和图书ID
2. 还书登记 - 输入读者ID和图书ID

#### 读者操作

1. 查询图书 - 输入关键字（或留空查看所有）
2. 查看借阅记录 - 输入读者ID

### 常见问题解决

#### 问题 1: 无法连接数据库
```
错误：数据库连接失败
```

**解决方案：**
1. 确认 MySQL 服务正在运行
   - Windows: 服务管理器中检查 MySQL 服务
   - Linux: `sudo systemctl status mysql`
2. 确认 ODBC DSN 配置正确
3. 确认用户名和密码正确
4. 检查防火墙设置

#### 问题 2: 找不到 ODBC 驱动
```
错误：ODBC驱动未找到
```

**解决方案：**
1. 重新安装 MySQL ODBC 驱动
2. 检查 odbcinst.ini 配置
3. 确认驱动文件路径正确

#### 问题 3: 编译错误
```
fatal error: sql.h: No such file or directory
```

**解决方案：**
- Linux: `sudo apt-get install unixodbc-dev`
- Windows: 确认 ODBC SDK 已安装

#### 问题 4: 链接错误
```
undefined reference to SQLAllocHandle
```

**解决方案：**
- Linux: 编译时添加 `-lodbc` 参数
- Windows: 链接 `odbc32.lib`

#### 问题 5: 中文显示乱码

**解决方案：**
1. 确认数据库字符集：
   ```sql
   SHOW VARIABLES LIKE 'character_set%';
   ```
2. 应该是 utf8mb4
3. 如果不是，重新创建数据库：
   ```sql
   DROP DATABASE library;
   CREATE DATABASE library CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   ```

### 数据库维护

#### 查看所有表
```sql
USE library;
SHOW TABLES;
```

#### 查看表结构
```sql
DESCRIBE books;
DESCRIBE users;
```

#### 查看数据
```sql
SELECT * FROM users;
SELECT * FROM books;
SELECT * FROM borrow WHERE returnDate IS NULL;  -- 查看未归还的书
```

#### 备份数据库
```bash
mysqldump -u root -p library > library_backup.sql
```

#### 恢复数据库
```bash
mysql -u root -p library < library_backup.sql
```

### 添加新用户

```sql
INSERT INTO users (username, password, role) VALUES
('newadmin', 'password123', 'admin'),
('newoper', 'password123', 'operator'),
('newreader', 'password123', 'reader');
```

### 添加新读者

```sql
INSERT INTO reader (borrowBookId, name, age, sex, address) VALUES
(1004, '新读者', 25, '男', '北京市海淀区');
```

### 性能优化建议

1. **定期清理过期数据**
   ```sql
   DELETE FROM borrow WHERE returnDate < DATE_SUB(NOW(), INTERVAL 1 YEAR);
   ```

2. **添加更多索引**（如果查询慢）
   ```sql
   CREATE INDEX idx_reader_name ON reader(name);
   ```

3. **定期优化表**
   ```sql
   OPTIMIZE TABLE books;
   OPTIMIZE TABLE borrow;
   ```

### 安全加固（生产环境）

1. **修改默认密码**
   ```sql
   UPDATE users SET password = 'new_secure_password' WHERE username = 'admin';
   ```

2. **创建专用数据库用户**
   ```sql
   CREATE USER 'library_app'@'localhost' IDENTIFIED BY 'strong_password';
   GRANT SELECT, INSERT, UPDATE, DELETE ON library.* TO 'library_app'@'localhost';
   FLUSH PRIVILEGES;
   ```

3. **启用 SSL 连接**
   - 修改 ODBC 连接字符串添加 SSL 参数

4. **实施参数化查询**
   - 参考 README.md 中的示例代码

### 卸载说明

#### Windows
1. 删除程序文件
2. 删除数据库：
   ```sql
   DROP DATABASE library;
   ```
3. 删除 ODBC DSN 配置

#### Linux
```bash
# 删除数据库
mysql -u root -p -e "DROP DATABASE library;"

# 删除程序文件
rm -rf /path/to/library_system
```

---

**部署支持**: 如遇问题，请参考 README.md 或在 GitHub 提交 Issue。
